syntax = "proto3";

option go_package = "github.com/twsnmp/twlogeye/api";

package twlogeye;

service TWLogEyeService {
	// Stop
	rpc Stop (Empty) returns (ControlResponse); 
	// Reload sigma rules
	rpc Reload (Empty) returns (ControlResponse); 
	// Watch Notify
	rpc WatchNotify (Empty) returns (stream NotifyResponse);
	// Search Notify
	rpc SearchNotify (NofifyRequest) returns (stream NotifyResponse);
  // Search Log
	rpc SearchLog (LogRequest) returns (stream LogResponse);
  // Get Syslog Report
	rpc GetSyslogReport (ReportRequest) returns (stream SyslogReportEnt);
  // Get Trap Report
	rpc GetTrapReport (ReportRequest) returns (stream TrapReportEnt);
  // Get Netflow Report
	rpc GetNetflowReport (ReportRequest) returns (stream NetFlowReportEnt);
  // Get Windows Event Report
	rpc GetWindowsEventReport (ReportRequest) returns (stream WindowsEventReportEnt);
}

message NofifyRequest {
	int64 start = 1;
	int64 end = 2;
	string level = 3;
}

message NotifyResponse {
	int64 time = 1;
	string id = 2;
	string level = 3;
	string title = 4;
	string tags = 5;
  string src = 6;
  string log = 7;
}

message LogRequest {
	int64 start = 1;
	int64 end = 2;
  string logtype = 3;
	string search = 4;
}

message LogResponse {
	int64 time = 1;
  string src = 3;
	string log = 4;
}

message ControlResponse {
  bool   ok   = 1;
	string message = 2;
}

message Empty {}

// Report

message ReportRequest {
	int64 start = 1;
	int64 end = 2;
}

message LogSummaryEnt {
  string log_pattern = 1;
  int32 count = 2;
}

message SyslogReportEnt {
  int64 time = 1;
  int32 normal = 2;
  int32 warn = 3;
  int32 error = 4;
  repeated LogSummaryEnt top_list = 5;
  repeated LogSummaryEnt top_error_list = 6;
}

message TrapSummaryEnt {
  string sender = 1;
  string trap_type = 2;
  int32 count = 3;
}

message TrapReportEnt {
  int64 time = 1;
  int32 count = 2;
  repeated TrapSummaryEnt top_list = 3;
}

message NetflowPacketsSummaryEnt {
  string key = 1;
  int32 packets = 2;
}

message NetflowBytesSummaryEnt {
  string key = 1;
  int64 bytes = 2;
}

message NetflowProtocolCountEnt {
  string protocol = 1;
  int32 count = 2;
}

message NetflowIPCountEnt {
  string ip = 1;
  int32 count = 2;
}

message NetFlowReportEnt {
  int64 time = 1;
  int64 packets = 2;
  int64 bytes = 3;
  repeated NetflowPacketsSummaryEnt top_mac_packets_list = 4;
  repeated NetflowBytesSummaryEnt top_mac_bytes_list = 5;
  repeated NetflowPacketsSummaryEnt top_ip_packets_list = 6;
  repeated NetflowBytesSummaryEnt top_ip_bytes_list = 7;
  repeated NetflowPacketsSummaryEnt top_flow_packets_list = 8;
  repeated NetflowBytesSummaryEnt top_flow_bytes_list = 9;
  repeated NetflowProtocolCountEnt top_protocol_list = 10;
  repeated NetflowIPCountEnt top_fumble_src_list = 11;
}


message WindowsEventSummary {
  string computer = 1;
  string provider = 2;
  string event_id = 3;
  int32 count = 4;
}

message WindowsEventReportEnt {
  int64 time = 1;
  int32 normal = 2;
  int32 warn = 3;
  int32 error = 4;
  repeated WindowsEventSummary top_list = 5;
  repeated WindowsEventSummary top_error_list = 6;
}

/*
protoc --go_out=. --go_opt=paths=source_relative \
	--go-grpc_out=. --go-grpc_opt=paths=source_relative \
	twlogeye.proto
*/